<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zone Access Control</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-4">
  <h2 class="mb-3 text-center">Zone Access Control</h2>

  <div class="text-center mb-4">
    <a href="/" class="btn btn-secondary btn-sm">üè† Dashboard</a>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
  <div class="container">
    {% for category, msg in messages %}
    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
      {{ msg }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  {% endwith %}

  <div class="card shadow p-4">
    <form method="POST" action="{{ url_for('update_access_control') }}">
      <div class="mb-3">
        <label class="form-label">Select Camera</label>
        <select class="form-select" name="camera_name" required>
          <option value="">-- Select Camera --</option>
          {% for cam in cameras %}
          <option value="{{ cam }}">{{ cam }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label">Allowed People</label>
        <div class="form-check">
          {% for person in people %}
          <input class="form-check-input" type="checkbox" name="allowed_people" value="{{ person.name }}" id="p{{ loop.index }}">
          <label class="form-check-label" for="p{{ loop.index }}">{{ person.name }}</label><br>
          {% endfor %}
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100">Save Access</button>
    </form>
  </div>

  <hr class="my-4">

  <h5 class="mb-3">Current Access Configuration</h5>
  <table class="table table-bordered table-striped align-middle">
    <thead>
      <tr>
        <th>Camera</th>
        <th>Allowed People</th>
      </tr>
    </thead>
    <tbody>
      {% for doc in access_docs %}
      <tr>
        <td><strong>{{ doc.camera_name }}</strong></td>
        <td>
          {% if doc.allowed_people %}
            {{ doc.allowed_people | join(', ') }}
          {% else %}
            <em>None</em>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
